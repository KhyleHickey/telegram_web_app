<!DOCTYPE html>
<html>
<head>
    <title>Mini Event</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" type="text/css" href="style.css" />
</head>
<body>
    <div id="event-list">
        <article id="admin-actions" style="display: none">
            <header>Admin Actions</header>

            <form autocomplete="off" id="new-event" style="display: none">
                <section>
                    <label for="new-event-title">Title</label>
                    <input type="text" id="new-event-title" name="title" required />
                    <label for="new-event-description">Description</label>
                    <input type="text" id="new-event-description" name="description"  required/>
                    <label for="new-event-image">Image</label>
                    <input type="file" id="new-event-image" name="image" />
                    <label for="new-event-start">Start Time</label>
                    <input type="time" id="new-event-start" name="start" pattern="[0-9]{2}:[0-9]{2}" required />
                    <label for="new-event-duration">Duration</label>
                    <input type="number" min="1" max="6" id="new-event-duration" value="1" name="duration" required/>
                </section>
                <p class="buttons">
                    <button id="confirm-button" type="submit">Confirm</button>
                    <button id="cancel-button">Cancel</button>
                </p>
            </form>

            <p class="buttons" id="admin-buttons">
                <button id="create-event-button">Create Event</button>
            </p>
        </article>
    </div>

    <script type="module">
        import { MiniEventApp } from "./src/mini_event.js";

        const mini_event_app = new MiniEventApp(
            window.Telegram,
            document.getElementById("event-list")
        );

        mini_event_app.connect_from_settings();

        // This makes it easier to debug on the browser console
        window.mini_event_app = mini_event_app;

        // Set up UI
        const create_event_button = document.getElementById("create-event-button");
        const admin_buttons = document.getElementById("admin-buttons");
        const new_event_form = document.getElementById("new-event");
        const cancel_button = document.getElementById("cancel-button");

        // time input is very janky on tdesktop so we fall back
        if ( Telegram.WebApp.platform == "tdesktop" )
        {
            const time_input = document.getElementById("new-event-start");
            time_input.type = "text";
            time_input.placeholder = "12:00";
        }

        function toggle_add_event(show)
        {
            admin_buttons.style.display = show ? "none" : "flex";
            new_event_form.style.display = show ? "flex" : "none";
            new_event_form.reset();
        }

        create_event_button.addEventListener("click", function(){
            toggle_add_event(true);
        });
        cancel_button.addEventListener("click", function(){
            toggle_add_event(false);
        });
        new_event_form.addEventListener("submit", function(ev){
            ev.preventDefault();

            const data = new FormData(new_event_form);
            let entries = {};
            for ( let [name, value] of data.entries() )
                entries[name] = value;

            console.log(entries);

//             toggle_add_event(false);
        });
    </script>
</body>
</html>
